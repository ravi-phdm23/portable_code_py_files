"""
Migration script to add statistical_tests_completed column to bulk_dataset_executions table.
Run this once to update existing database schema.
"""

from sqlalchemy import create_engine, text
from config import get_database_url


def migrate():
    """Add statistical_tests_completed column if it doesn't exist"""

    db_url = get_database_url()
    engine = create_engine(db_url)

    with engine.connect() as conn:
        # Check if column exists
        result = conn.execute(text("PRAGMA table_info(bulk_dataset_executions)"))
        columns = [row[1] for row in result.fetchall()]

        if 'statistical_tests_completed' not in columns:
            print("Adding statistical_tests_completed column...")
            conn.execute(text(
                "ALTER TABLE bulk_dataset_executions "
                "ADD COLUMN statistical_tests_completed BOOLEAN DEFAULT 0"
            ))
            conn.commit()
            print("Migration complete: statistical_tests_completed column added")
        else:
            print("Column statistical_tests_completed already exists, skipping migration")


if __name__ == "__main__":
    migrate()
